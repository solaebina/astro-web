---
import { getCollection } from "astro:content";
import PageLayout from "@layouts/PageLayout.astro";
import Container from "@components/Container.astro";
import ListItem from "@components/ListItem.astro";
import { SITE, MARKETING } from "@consts";

// Helper function to format date
function formatDate(date: Date): string {
  const month = date.toLocaleString("default", { month: "long" });
  const year = date.getFullYear();
  return `${month} ${year}`;
}

// Helper function to get filtered and sorted projects
function getFilteredProjects<T extends { data: { draft?: boolean; date: Date } }>(collection: T[], limit: number) {
  return collection
    .filter((item) => !item.data.draft)
    .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
    .slice(0, limit);
}

// Get all collections
const allProjects = await getCollection("projects");

// Get marketing projects only
const marketingProjects = getFilteredProjects(
  allProjects.filter(project => project.data.categories?.includes("marketing")),
  SITE.NUM_PROJECTS_ON_HOMEPAGE
);
---

<PageLayout title={MARKETING.TITLE} description={MARKETING.DESCRIPTION}>
  <Container>
    <div class="space-y-8">
      <!-- Introduction Section -->
      <section class="space-y-4">
        <h1 class="animate font-semibold text-black dark:text-white text-2xl">
          Hi, I'm Sola <span class="text-xl">üëãüèª </span> <br>Truth is stranger than fiction
        </h1>
        <ul class="flex flex-wrap gap-2 animate text-sm">
          <li class="flex gap-x-2 text-nowrap">
            <a href="https://www.linkedin.com/in/solaebina/" class="text-current hover:text-black hover:dark:text-white transition-colors duration-300 ease-in-out underline underline-offset-2">
              linkedIn
            </a>
            {"/"}
          </li>
          <li class="line-clamp-1">
            <a href="mailto:solaebina@gmail.com" class="text-current hover:text-black hover:dark:text-white transition-colors duration-300 ease-in-out underline underline-offset-2">
              solaebina@gmail.com
            </a>
          </li>
        </ul>
      </section>


      <!-- Featured Marketing Projects -->
      <section class="animate space-y-4">
        <h2 class="text-xl font-semibold text-black dark:text-white">
          Featured Marketing Projects
        </h2>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          {marketingProjects.map(project => (
            <div class="w-full">
              <a 
                href={`/projects/${project.slug}`} 
                class="group block p-6 -ml-6 -mr-6 rounded-xl transition-all duration-300"
              >
                <div class="space-y-4">
                  <!-- Image at the top -->
                  {project.data.image && (
                    <div class="overflow-hidden rounded-lg">
                      <img 
                        src={project.data.image} 
                        alt={`${project.data.title} preview`}
                        class="w-full h-64 object-cover group-hover:scale-105 transition-transform duration-300"
                      />
                    </div>
                  )}
                  
                  <!-- Title and Date -->
                  <div class="space-y-2">
                    <h3 class="text-base font-bold text-gray-900 dark:text-white transition-colors duration-200 group-hover:text-black dark:group-hover:text-white">
                      {project.data.title}
                    </h3>
                    <time class="text-sm text-gray-500 dark:text-gray-400 font-mono">
                      {formatDate(project.data.date)}
                    </time>
                  </div>
                  
                  <!-- Description -->
                  <p class="text-sm text-gray-600 dark:text-gray-400 leading-relaxed max-w-3xl">
                    {project.data.description}
                  </p>
                </div>
              </a>
            </div>
          ))}
        </div>
      </section>

      <!-- All Marketing Projects List -->
      <section class="animate space-y-4">
        <h2 class="text-xl font-semibold text-black dark:text-white">
          All Marketing Projects
        </h2>
        
        <ul class="space-y-2 group">
          {marketingProjects.map(project => (
            <li class="peer-hover:bg-gray-50 dark:peer-hover:bg-gray-900/30 hover:bg-transparent transition-all duration-200">
              <ListItem entry={project} />
            </li>
          ))}
        </ul>
      </section>
    </div>
  </Container>
</PageLayout>
