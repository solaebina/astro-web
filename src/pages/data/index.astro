---
import { getCollection } from "astro:content";
import PageLayout from "@layouts/PageLayout.astro";
import Container from "@components/Container.astro";
import ListItem from "@components/ListItem.astro";
import Link from "@components/Link.astro";
import { SITE, DATA_AI } from "@consts";

// Helper function to format date
function formatDate(date: Date): string {
  const month = date.toLocaleString("default", { month: "long" });
  const year = date.getFullYear();
  return `${month} ${year}`;
}

// Helper function to get filtered and sorted projects
function getFilteredProjects<T extends { data: { draft?: boolean; date: Date; featured?: boolean } }>(collection: T[], limit: number) {
  return collection
    .filter((item) => !item.data.draft)
    .filter((item) => item.data.featured === true)
    .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
    .slice(0, limit);
}

// Get all collections
const allProjects = await getCollection("projects");

// Get data-ai projects only
const dataAIProjects = allProjects.filter(project => 
  project.data.categories?.some(cat => cat.includes("data") || cat.includes("ai"))
).sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// Get featured data-ai projects only
const featuredDataAIProjects = getFilteredProjects(
  dataAIProjects,
  SITE.NUM_PROJECTS_ON_HOMEPAGE
);
---

<PageLayout title={DATA_AI.TITLE} description={DATA_AI.DESCRIPTION}>
  <Container>
    <div class="space-y-6 sm:space-y-8">

      <!-- Featured Data & AI Projects -->
      <section class="animate space-y-4">
        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-4 sm:space-y-0">
          <h2 class="font-ba text-xl font-semibold text-black dark:text-white">
            Featured Data & AI Projects
          </h2>

          <ul class="font-lc flex flex-wrap animate text-base">
            <li class="flex gap-x-6 text-nowrap">
              <Link underline={false} href="https://www.linkedin.com/in/solaebina/" external={true}>linkedin</Link>
              <Link underline={false} href="mailto:mail@solaebina.me" external={true}>mail</Link>
            </li>
          </ul>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8">
          {featuredDataAIProjects.map(project => (
            <div class="w-full">
              <a 
                href={`/projects/${project.slug}`} 
                class="group block p-4 sm:p-6 rounded-xl transition-all duration-300"
              >
                <div class="space-y-4">
                  <!-- Image at the top -->
                  {project.data.image && (
                    <div class="aspect-video overflow-hidden rounded-lg bg-gray-100 dark:bg-gray-800">
                      <img 
                        src={project.data.image} 
                        alt={`${project.data.title} preview`}
                        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                      />
                    </div>
                  )}
                  
                  <!-- Title and Date -->
                  <div class="space-y-2">
                    <h3 class="font-ba text-base font-bold text-gray-900 dark:text-white transition-colors duration-200 group-hover:text-black dark:group-hover:text-white">
                      {project.data.title}
                    </h3>
                    <time class="text-sm text-gray-500 dark:text-gray-400 font-mono">
                      {formatDate(project.data.date)}
                    </time>
                  </div>
                  
                  <!-- Description -->
                  <p class="font-lc text-sm text-gray-600 dark:text-gray-400 leading-relaxed">
                    {project.data.description}
                  </p>
                </div>
              </a>
            </div>
          ))}
        </div>
      </section>

      <!-- All Data & AI Projects List -->
      <section class="animate space-y-4">
        <h2 class="text-xl font-semibold text-black dark:text-white">
          All Data & AI Projects
        </h2>
        
        <ul class="space-y-2 group">
          {dataAIProjects.map(project => (
            <li class="peer-hover:bg-gray-50 dark:peer-hover:bg-gray-900/30 hover:bg-transparent transition-all duration-200">
              <ListItem entry={project} />
            </li>
          ))}
        </ul>
      </section>
    </div>
  </Container>
</PageLayout>
